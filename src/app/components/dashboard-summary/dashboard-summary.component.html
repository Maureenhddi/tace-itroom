<div class="dashboard-container">
  <h2 class="dashboard-title">Résumé des Taux d'Activité par Mois</h2>
  <div class="summary-grid">
    @for (summary of monthlySummaries; track summary.month) {
      <mat-card class="month-card">
        <mat-card-header>
          <mat-card-title>{{ summary.month }}</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <!-- Taux totaux -->
          <div class="metric-section total-section">
            <h3 class="section-title">Global</h3>
            <div class="metrics-row">
              <div class="metric-item total-real" [ngClass]="getRateClass(summary.totalMetrics.realRate)">
                <span class="metric-label">Taux réel</span>
                <span class="metric-value">{{ summary.totalMetrics.realRate }}%</span>
              </div>
              <div class="metric-item total-estimated" [ngClass]="getRateClass(summary.totalMetrics.estimatedRate)">
                <span class="metric-label">Taux estimé</span>
                <span class="metric-value">{{ summary.totalMetrics.estimatedRate }}%</span>
              </div>
            </div>
          </div>

          <!-- Taux par équipe -->
          <div class="metric-section">
            <h3 class="section-title">Par Équipe</h3>
            <div class="metrics-row">
              <div class="metric-item team-front" [ngClass]="getRateClass(summary.teamMetrics.frontRate)">
                <span class="metric-label">Front</span>
                <span class="metric-value">{{ summary.teamMetrics.frontRate }}%</span>
              </div>
              <div class="metric-item team-back" [ngClass]="getRateClass(summary.teamMetrics.backRate)">
                <span class="metric-label">Back</span>
                <span class="metric-value">{{ summary.teamMetrics.backRate }}%</span>
              </div>
            </div>
          </div>

          <!-- Taux par expertise -->
          <div class="metric-section">
            <h3 class="section-title">Par Expertise</h3>
            <div class="metrics-row">
              <div class="metric-item expertise-ecommerce" [ngClass]="getRateClass(summary.expertiseMetrics.ecommerceRate)">
                <span class="metric-label">E-commerce</span>
                <span class="metric-value">{{ summary.expertiseMetrics.ecommerceRate }}%</span>
              </div>
              <div class="metric-item expertise-surmesure" [ngClass]="getRateClass(summary.expertiseMetrics.surMesureRate)">
                <span class="metric-label">Sur mesure</span>
                <span class="metric-value">{{ summary.expertiseMetrics.surMesureRate }}%</span>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    }
  </div>

  <!-- Graphiques consolidés du taux d'activité réel des équipes -->
  @if (consolidatedDailyMetrics.length > 0) {
    <div class="consolidated-charts-section">
      <h2 class="section-title">Taux d'Activité Réel des Équipes (Tous les mois)</h2>

      <app-activity-chart
        [dailyMetrics]="consolidatedDailyMetrics"
        [chartType]="'expertise'"
        [title]="'Taux d\'activité réel - E-commerce vs Sur mesure'">
      </app-activity-chart>

      <app-activity-chart
        [dailyMetrics]="consolidatedDailyMetrics"
        [chartType]="'ecommerce-teams'"
        [title]="'Taux d\'activité réel E-commerce - Front vs Back'">
      </app-activity-chart>

      <app-activity-chart
        [dailyMetrics]="consolidatedDailyMetrics"
        [chartType]="'surmesure-teams'"
        [title]="'Taux d\'activité réel Sur mesure - Front vs Back'">
      </app-activity-chart>
    </div>
  }

</div>
